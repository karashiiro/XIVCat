@page "/item/{itemId}"

@using Lumina
@using Lumina.Excel.GeneratedSheets
@inject GameData GameDataService

<img src="@Util.GetIconUrl(item?.RowId ?? 0)" width="120" height="120" alt=""/>

<h1>@item?.Name</h1>
<span>@item?.Description</span>

<h3>Used In</h3>
@if (recipes == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <colgroup>
            <col span="1" style="width: 10%;"/>
            <col span="1" style="width: 10%;"/>
            <col span="1" style="width: 30%;"/>
            <col span="1" style="width: 50%;"/>
        </colgroup>
        <thead>
        <tr>
            <th>Icon</th>
            <th>ID</th>
            <th>Name</th>
            <th>Item Level</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var recipe in recipes)
        {
            var result = recipe.ItemResult.Value;
            <tr>
                <td><img src="@Util.GetIconUrl(result?.Icon ?? 0)" alt="" width="50" height="50"/></td>
                <td>@result?.RowId</td>
                <td><NavLink href="@Util.GetItemPageUrl(result?.RowId ?? 0)">@result?.Name</NavLink></td>
                <td>@result?.LevelItem.Row</td>
            </tr>
        }
        </tbody>
    </table>
}

@code {
    private Item? item;

    private IList<Recipe>? recipes;

    [Parameter]
    public string? ItemId { get; set; }

    protected override void OnInitialized()
    {
        item = GameDataService.GetExcelSheet<Item>()?.GetRow(Convert.ToUInt32(ItemId));
        recipes = GameDataService.GetExcelSheet<Recipe>()?.Where(r => r.UnkData5.Any(i => i.ItemIngredient == item?.RowId)).ToList();
    }
}
